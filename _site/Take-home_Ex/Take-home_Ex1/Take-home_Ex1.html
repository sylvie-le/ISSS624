<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.189">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Sylvia’s Geospatial Journey - Take-home Exercise 1: How Functional are the Water Points in Nigeria?</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Sylvia’s Geospatial Journey</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-hands-on-exercises" role="button" data-bs-toggle="dropdown" aria-expanded="false">Hands-on Exercises</a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-hands-on-exercises">    
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex01.html">
 <span class="dropdown-text">Hands-on Exercise 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex02.html">
 <span class="dropdown-text">Hands-on Exercise 2</span></a>
  </li>
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex03.html">
 <span class="dropdown-text">Hands-on Exercise 3</span></a>
  </li>
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex04.html">
 <span class="dropdown-text">Hands-on Exercise 4</span></a>
  </li>
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-in-class-exercises" role="button" data-bs-toggle="dropdown" aria-expanded="false">In-class Exercises</a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-in-class-exercises">    
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex1/In-class_ex1.html">
 <span class="dropdown-text">In-class Exercise 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex2/In-class_Ex2.html">
 <span class="dropdown-text">In-class Exercise 2</span></a>
  </li>
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex3/In-class_Ex3.html">
 <span class="dropdown-text">In-class Exercise 3</span></a>
  </li>
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex4/In-class_Ex4.html">
 <span class="dropdown-text">In-class Exercise 4</span></a>
  </li>
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-take-home-exercises" role="button" data-bs-toggle="dropdown" aria-expanded="false">Take-home Exercises</a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-take-home-exercises">    
        <li>
    <a class="dropdown-item" href="../../Take-home_Ex/Take-home_Ex1/Take-home_Ex1.html">
 <span class="dropdown-text">Take-home Exercise 1</span></a>
  </li>
        <li>
    <a class="dropdown-item" href="../../Take-home_Ex/Take-home_Ex2/Take-home_Ex2.html">
 <span class="dropdown-text">Take-home Exercise 2</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html">Home</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html">About</a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview">Overview</a>
  <ul class="collapse">
  <li><a href="#social-context" id="toc-social-context" class="nav-link" data-scroll-target="#social-context">Social Context</a></li>
  <li><a href="#objective" id="toc-objective" class="nav-link" data-scroll-target="#objective">Objective</a></li>
  </ul></li>
  <li><a href="#setup" id="toc-setup" class="nav-link" data-scroll-target="#setup">Setup</a>
  <ul class="collapse">
  <li><a href="#data" id="toc-data" class="nav-link" data-scroll-target="#data">Data</a></li>
  <li><a href="#r-packages-used" id="toc-r-packages-used" class="nav-link" data-scroll-target="#r-packages-used">R Packages Used</a></li>
  </ul></li>
  <li><a href="#importing-data" id="toc-importing-data" class="nav-link" data-scroll-target="#importing-data">Importing Data</a>
  <ul class="collapse">
  <li><a href="#importing-nigeria-water-point-geospatial-data" id="toc-importing-nigeria-water-point-geospatial-data" class="nav-link" data-scroll-target="#importing-nigeria-water-point-geospatial-data">Importing Nigeria water point geospatial data</a></li>
  <li><a href="#importing-nigeria-adm2-aspatial-data" id="toc-importing-nigeria-adm2-aspatial-data" class="nav-link" data-scroll-target="#importing-nigeria-adm2-aspatial-data">Importing Nigeria ADM2 aspatial data</a></li>
  </ul></li>
  <li><a href="#exploratory-data-analysis-and-data-wrangling" id="toc-exploratory-data-analysis-and-data-wrangling" class="nav-link" data-scroll-target="#exploratory-data-analysis-and-data-wrangling">Exploratory Data Analysis and Data Wrangling</a>
  <ul class="collapse">
  <li><a href="#wp-geospatial-data" id="toc-wp-geospatial-data" class="nav-link" data-scroll-target="#wp-geospatial-data"><code>wp</code> geospatial data</a></li>
  <li><a href="#nga-aspatial-data" id="toc-nga-aspatial-data" class="nav-link" data-scroll-target="#nga-aspatial-data"><code>nga</code> aspatial data</a></li>
  <li><a href="#performing-point-in-polygon-count" id="toc-performing-point-in-polygon-count" class="nav-link" data-scroll-target="#performing-point-in-polygon-count">Performing Point-in-Polygon Count</a></li>
  <li><a href="#saving-the-analytical-data-table" id="toc-saving-the-analytical-data-table" class="nav-link" data-scroll-target="#saving-the-analytical-data-table">Saving the analytical data table</a></li>
  </ul></li>
  <li><a href="#visualizing-the-data" id="toc-visualizing-the-data" class="nav-link" data-scroll-target="#visualizing-the-data">Visualizing the Data</a>
  <ul class="collapse">
  <li><a href="#displaying-non-functional-water-points-with-choropleth-map" id="toc-displaying-non-functional-water-points-with-choropleth-map" class="nav-link" data-scroll-target="#displaying-non-functional-water-points-with-choropleth-map">Displaying non-functional water points with choropleth map</a></li>
  </ul></li>
  <li><a href="#global-spatial-autocorrelation" id="toc-global-spatial-autocorrelation" class="nav-link" data-scroll-target="#global-spatial-autocorrelation">Global Spatial Autocorrelation</a>
  <ul class="collapse">
  <li><a href="#computing-spatial-weights" id="toc-computing-spatial-weights" class="nav-link" data-scroll-target="#computing-spatial-weights">Computing Spatial Weights</a></li>
  <li><a href="#global-spatial-autocorrelation-morans-i" id="toc-global-spatial-autocorrelation-morans-i" class="nav-link" data-scroll-target="#global-spatial-autocorrelation-morans-i">Global Spatial Autocorrelation: Moran’s I</a></li>
  <li><a href="#global-spatial-autocorrelation-gearys-c" id="toc-global-spatial-autocorrelation-gearys-c" class="nav-link" data-scroll-target="#global-spatial-autocorrelation-gearys-c">Global Spatial Autocorrelation: Geary’s C</a></li>
  </ul></li>
  <li><a href="#spatial-correlogram-with-morans-i" id="toc-spatial-correlogram-with-morans-i" class="nav-link" data-scroll-target="#spatial-correlogram-with-morans-i">Spatial Correlogram with Moran’s I</a></li>
  <li><a href="#cluster-and-outlier-analysis" id="toc-cluster-and-outlier-analysis" class="nav-link" data-scroll-target="#cluster-and-outlier-analysis">Cluster and Outlier Analysis</a>
  <ul class="collapse">
  <li><a href="#computing-local-morans-i" id="toc-computing-local-morans-i" class="nav-link" data-scroll-target="#computing-local-morans-i">Computing local Moran’s I</a></li>
  <li><a href="#mapping-the-local-morans-i" id="toc-mapping-the-local-morans-i" class="nav-link" data-scroll-target="#mapping-the-local-morans-i">Mapping the local Moran’s I</a></li>
  </ul></li>
  <li><a href="#lisa-cluster-map" id="toc-lisa-cluster-map" class="nav-link" data-scroll-target="#lisa-cluster-map">LISA Cluster Map</a>
  <ul class="collapse">
  <li><a href="#plotting-moran-scatterplots" id="toc-plotting-moran-scatterplots" class="nav-link" data-scroll-target="#plotting-moran-scatterplots">Plotting Moran scatterplots</a></li>
  <li><a href="#plotting-lisa-map" id="toc-plotting-lisa-map" class="nav-link" data-scroll-target="#plotting-lisa-map">Plotting LISA map</a></li>
  </ul></li>
  <li><a href="#hot-spot-and-cold-spot-analysis" id="toc-hot-spot-and-cold-spot-analysis" class="nav-link" data-scroll-target="#hot-spot-and-cold-spot-analysis">Hot Spot and Cold Spot Analysis</a>
  <ul class="collapse">
  <li><a href="#computing-gi-statistics" id="toc-computing-gi-statistics" class="nav-link" data-scroll-target="#computing-gi-statistics">Computing Gi statistics</a></li>
  <li><a href="#mapping-gi-values" id="toc-mapping-gi-values" class="nav-link" data-scroll-target="#mapping-gi-values">Mapping Gi values</a></li>
  </ul></li>
  <li><a href="#comparing-lisa-and-gi-maps" id="toc-comparing-lisa-and-gi-maps" class="nav-link" data-scroll-target="#comparing-lisa-and-gi-maps">Comparing LISA and Gi Maps</a></li>
  <li><a href="#conclusion-and-improvement" id="toc-conclusion-and-improvement" class="nav-link" data-scroll-target="#conclusion-and-improvement">Conclusion and Improvement</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Take-home Exercise 1: How Functional are the Water Points in Nigeria?</h1>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<section id="overview" class="level2">
<h2 class="anchored" data-anchor-id="overview">Overview</h2>
<section id="social-context" class="level3">
<h3 class="anchored" data-anchor-id="social-context">Social Context</h3>
<p>Water is a critical asset of all communities and nations. It is the core neccessity to sustain the life of both humans and livestock. Lack of access to potable water can lead to serious health hazards and even conflicts between communities and states. According to a 2022 report by World Bank, about 70 million Nigerians do not have access to drinkable water. Access to piped water has decreased from 39% in 1990 to only 11% in 2021. This phenomenon contributes to a surge in violence in Nigeria when communities Fulani herders ad farmers fight over water supplies.</p>
<p>Why is there a water crisis in Nigeria? To gain a perspective on the answer, we will examine the quality and distribution of water supply points in Nigeria.</p>
</section>
<section id="objective" class="level3">
<h3 class="anchored" data-anchor-id="objective">Objective</h3>
<p>The objective of this exercise is to apply appropriate global and local measures of spatial association techniques to reveals the spatial patterns of non-functional water points in Nigeria.</p>
</section>
</section>
<section id="setup" class="level2">
<h2 class="anchored" data-anchor-id="setup">Setup</h2>
<section id="data" class="level3">
<h3 class="anchored" data-anchor-id="data">Data</h3>
<section id="aspatial-data" class="level4">
<h4 class="anchored" data-anchor-id="aspatial-data">Aspatial Data</h4>
<p>The aspatial data of water points quality, status and other relevant information is taken from <a href="https://data.waterpointdata.org/dataset/Water-Point-Data-Exchange-Plus-WPdx-/eqje-vguj/data">WPdx Global Data Repositories - WPdx+ version</a>. The data set is downloaded in Shapefile format.</p>
</section>
<section id="geospatial-data" class="level4">
<h4 class="anchored" data-anchor-id="geospatial-data">Geospatial Data</h4>
<p>The geospatial data of Nigeria administrative regions is downloaded from <a href="https://www.geoboundaries.org/index.html#getdata">Geoboundaries</a>. The data level of ADM2, published in 2020, will be used.</p>
</section>
</section>
<section id="r-packages-used" class="level3">
<h3 class="anchored" data-anchor-id="r-packages-used">R Packages Used</h3>
<ul>
<li><p><strong>sf</strong>: used for importing, managing, and processing geospatial data</p></li>
<li><p><strong>tidyverse</strong>: a collection of packages for data science tasks. It contains the sub-packages dplyr, ggplot2, forcats, tibble, readr, stringr, tidyr, purrr</p></li>
<li><p><strong>tmap</strong>: used for creating thematic maps, such as choropleth and bubble maps</p></li>
<li><p><strong>spdep</strong>: used for calculating spatial dependence - weighting schemes and statistics</p></li>
<li><p><strong>funModeling</strong>: used for EDA and data preparation</p></li>
</ul>
<p>We load the packages into our working environment using the code below.</p>
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(sf, tidyverse, tmap, spdep, funModeling)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="importing-data" class="level2">
<h2 class="anchored" data-anchor-id="importing-data">Importing Data</h2>
<section id="importing-nigeria-water-point-geospatial-data" class="level3">
<h3 class="anchored" data-anchor-id="importing-nigeria-water-point-geospatial-data">Importing Nigeria water point geospatial data</h3>
<p>The data from WPdx Global Data Repositories comes in four files in dbf, prj, shp, shx formats. The files are renamed into <code>geo_export</code> for a more convenient reference.</p>
<p>Using <code>st_read()</code> from the <strong>sf</strong> package, we import the aspatial data into our working environment. The data is imported as a simple feature data table.</p>
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>wp <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="at">dsn =</span> <span class="st">"data"</span>, <span class="at">layer =</span> <span class="st">"geo_export"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `geo_export' from data source 
  `/Users/sylvia/sylvie-le/ISSS624/Take-home_Ex/Take-home_Ex1/data' 
  using driver `ESRI Shapefile'
Simple feature collection with 406566 features and 72 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: -92.05073 ymin: -27.31495 xmax: 92.32694 ymax: 26.65622
Geodetic CRS:  WGS84(DD)</code></pre>
</div>
</div>
</section>
<section id="importing-nigeria-adm2-aspatial-data" class="level3">
<h3 class="anchored" data-anchor-id="importing-nigeria-adm2-aspatial-data">Importing Nigeria ADM2 aspatial data</h3>
<p>The data from Geoboundaries comes in six files in dbf, geojson, prj, shp, shx, topojson formats. The files are renamed to <code>NGA-ADM2</code> for easier reference. To import these files as a simple feature data table, we also use <code>st_read().</code></p>
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>nga <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="at">dsn =</span> <span class="st">"data"</span>, <span class="at">layer =</span> <span class="st">"NGA-ADM2"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `NGA-ADM2' from data source 
  `/Users/sylvia/sylvie-le/ISSS624/Take-home_Ex/Take-home_Ex1/data' 
  using driver `ESRI Shapefile'
Simple feature collection with 774 features and 5 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 2.668534 ymin: 4.273007 xmax: 14.67882 ymax: 13.89442
Geodetic CRS:  WGS 84</code></pre>
</div>
</div>
</section>
</section>
<section id="exploratory-data-analysis-and-data-wrangling" class="level2">
<h2 class="anchored" data-anchor-id="exploratory-data-analysis-and-data-wrangling">Exploratory Data Analysis and Data Wrangling</h2>
<p>The goals of this step include:</p>
<ul>
<li><p>Examine the data structure and format, ensure consistent format between geospatial and aspatial data.</p></li>
<li><p>Study the content of the data tables and filter out data that are not related to water points in Nigeria.</p></li>
<li><p>Explore data type and data validity relating to the functionality of water points in Nigeria, transform the data where necessary.</p></li>
</ul>
<section id="wp-geospatial-data" class="level3">
<h3 class="anchored" data-anchor-id="wp-geospatial-data"><code>wp</code> geospatial data</h3>
<section id="checking-the-crs-of-geospatial-data" class="level4">
<h4 class="anchored" data-anchor-id="checking-the-crs-of-geospatial-data">Checking the CRS of geospatial data</h4>
<p>First, we use <code>st_geometry()</code> to check the geometry list column of <code>wp</code>. There are 406,566 observations under the WGS84 coordinate reference system (CRS). Let’s take notes that the geometry type is <code>point</code> 🔑</p>
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_geometry</span>(wp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Geometry set for 406566 features 
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: -92.05073 ymin: -27.31495 xmax: 92.32694 ymax: 26.65622
Geodetic CRS:  WGS84(DD)
First 5 geometries:</code></pre>
</div>
</div>
<p>Since the shapefile is in WGS84 CRS, we will assign <code>crs = 4326</code> to <code>wp</code>. 4326 is the code of WGS84 in EPSG code. The task is conducted using <code>st_set_crs()</code>.</p>
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>wp <span class="ot">&lt;-</span> <span class="fu">st_set_crs</span>(wp, <span class="dv">4326</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="filtering-relevant-information" class="level4">
<h4 class="anchored" data-anchor-id="filtering-relevant-information">Filtering relevant information</h4>
<p>Next, we will examine the attributes in the data table using <code>glimpse()</code> from <strong>dplyr</strong>.</p>
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(wp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 406,566
Columns: 73
$ row_id      &lt;dbl&gt; 651816, 584864, 509399, 21983, 660321, 666619, 657081, 669…
$ source      &lt;chr&gt; "Water For People", "Global Environment and Technology Fou…
$ lat_deg     &lt;dbl&gt; -15.726464200, 6.723120000, 8.001933333, 8.084948140, 0.18…
$ lon_deg     &lt;dbl&gt; 35.05067, -1.58151, -11.28760, -10.12595, 30.44659, 30.352…
$ date_repor  &lt;date&gt; 2018-06-11, 2017-10-25, 2010-12-31, 2015-12-04, 2019-03-1…
$ time_repor  &lt;chr&gt; "00:00:00.000", "00:00:00.000", "00:00:00.000", "00:00:00.…
$ status_id   &lt;chr&gt; "Yes", "Yes", "Yes", "Yes", "Yes", "Yes", "Yes", "Yes", "Y…
$ water_sour  &lt;chr&gt; NA, NA, NA, NA, "Piped Water", "Piped Water", NA, NA, NA, …
$ water_so_2  &lt;chr&gt; NA, NA, NA, NA, "Piped Water", "Piped Water", NA, NA, NA, …
$ water_te_2  &lt;chr&gt; "Kiosk", "Tapstand", "Tapstand", "Tapstand", NA, NA, "Taps…
$ X_water_tec &lt;chr&gt; "Tapstand", "Tapstand", "Tapstand", "Tapstand", NA, NA, "T…
$ facility_t  &lt;chr&gt; "Improved", "Improved", "Improved", "Improved", "Improved"…
$ clean_coun  &lt;chr&gt; "Malawi", "Ghana", "Sierra Leone", "Liberia", "Uganda", "U…
$ clean_adm1  &lt;chr&gt; "Blantyre", "Ashanti", "Eastern", "Lofa", "Western", "West…
$ clean_adm2  &lt;chr&gt; "Blantyre City", "Asokore Mampong Municipal", "Kenema", "K…
$ clean_adm3  &lt;chr&gt; "n.a. (2465)", NA, "Kando Leppeama", "Lucasu", "Kibale", "…
$ clean_adm4  &lt;chr&gt; NA, NA, NA, NA, "Kamwenge Town Council", "Buhanda", "Mahyo…
$ install_ye  &lt;dbl&gt; NA, 2017, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
$ installer   &lt;chr&gt; NA, NA, "Water Aid", NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
$ rehab_year  &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…
$ rehabilita  &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…
$ manageme_2  &lt;chr&gt; NA, NA, NA, "School Management", NA, NA, NA, NA, NA, NA, N…
$ status_cle  &lt;chr&gt; NA, NA, "Functional", NA, NA, NA, NA, NA, NA, NA, NA, NA, …
$ pay         &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…
$ fecal_coli  &lt;chr&gt; NA, NA, NA, NA, "Present", "Present", "Present", NA, NA, "…
$ fecal_co_2  &lt;chr&gt; NA, "0", NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
$ subjective  &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…
$ activity_i  &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…
$ scheme_id   &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…
$ wpdx_id     &lt;chr&gt; "5GPQ73F2+C77", "6CRWPCF9+69X", "6CWC2P26+QXC", "6CWF3VMF+…
$ notes       &lt;chr&gt; NA, NA, "Poor?Jenneh?Kandu Leppiema??", NA, NA, NA, NA, NA…
$ orig_lnk    &lt;chr&gt; NA, NA, NA, "https://wash-liberia.org/raw-water-point-data…
$ photo_lnk   &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…
$ country_id  &lt;chr&gt; "MW", "GH", "SL", "LR", "UG", "UG", "UG", "UG", "UG", "UG"…
$ data_lnk    &lt;chr&gt; "https://catalog.waterpointdata.org/datasets/wfp-2017-2020…
$ distance_t  &lt;dbl&gt; 7034.8250, 3677.9101, 17540.3622, 21602.1376, 31948.1224, …
$ distance_2  &lt;dbl&gt; 3431.81039, 3944.70081, 4052.93329, 37030.19501, 593.69582…
$ distance_3  &lt;dbl&gt; 421.90674, 690.13048, 104.43156, 14456.72395, 149.01742, 1…
$ distance_4  &lt;dbl&gt; 8321.854, 5362.011, 17003.136, 52727.389, 40206.411, 38061…
$ distance_5  &lt;dbl&gt; 22044.5149, 7550.3392, 15474.4428, 31606.4649, 35770.4357,…
$ water_poin  &lt;chr&gt; "{\"2018-06-11\": {\"source\": \"Water For People\", \"sta…
$ rehab_prio  &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…
$ served_pop  &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…
$ local_popu  &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…
$ crucialnes  &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…
$ pressure    &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…
$ usage_cap   &lt;dbl&gt; 250, 250, 250, 250, 250, 250, 250, 250, 250, 250, 250, 250…
$ is_urban    &lt;chr&gt; "True", "True", "False", "False", "False", "False", "False…
$ days_since  &lt;dbl&gt; 1562, 1791, 4281, 2482, 1286, 1281, 1660, 6222, 1663, 1280…
$ staleness_  &lt;dbl&gt; 61.11805, 56.86178, 25.93887, 45.73258, 66.67340, 66.77856…
$ is_latest   &lt;chr&gt; "T", "T", "T", "T", "T", "T", "T", "T", "T", "T", "T", "T"…
$ location_i  &lt;dbl&gt; 355848, 349148, 98255, 285679, 362508, 362657, 351144, 777…
$ cluster_si  &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…
$ clean_co_2  &lt;chr&gt; "MWI", "GHA", "SLE", "LBR", "UGA", "UGA", "UGA", "UGA", "U…
$ country_na  &lt;chr&gt; "Malawi", "Ghana", "Sierra Leone", "Liberia", "Uganda", "U…
$ water_so_3  &lt;chr&gt; NA, NA, "Gravity stand-post", "Public standpipe", NA, NA, …
$ water_tech  &lt;chr&gt; "Communal water kiosk", "Standpost", NA, NA, "Pumped piped…
$ status      &lt;chr&gt; "1", NA, "Functional", NA, "1", "0", "1", "1", "1", "1", N…
$ adm2        &lt;chr&gt; "Kameza", NA, "Kenema", NA, "Kibale", "Kitagwenda", "Kitag…
$ adm3        &lt;chr&gt; NA, NA, NA, NA, "Kamwenge T/Council", "Buhanda", "Mahyoro"…
$ management  &lt;chr&gt; NA, NA, NA, "Institutional Management - School", NA, NA, N…
$ adm1        &lt;chr&gt; "Blantyre", NA, "Eastern", "Lofa", "Kamwenge", "Kamwenge",…
$ lat_deg_or  &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…
$ lat_lon_de  &lt;chr&gt; "(-15.7264642?, 35.0506729?)", "(6.72312?, -1.58151?)", "(…
$ lon_deg_or  &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…
$ public_dat  &lt;chr&gt; "https://catalog.waterpointdata.org/datafiles/wfp-2017-202…
$ converted   &lt;chr&gt; NA, NA, "#install_year, #notes", "#status", NA, NA, NA, NA…
$ count       &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…
$ date_creat  &lt;date&gt; 2022-02-18, 2020-07-29, 2020-07-30, 2020-09-11, 2022-02-1…
$ time_creat  &lt;chr&gt; "05:36:33.000", "19:21:47.000", "08:35:45.000", "11:22:31.…
$ date_updat  &lt;date&gt; 2022-02-18, 2020-07-29, 2020-07-30, 2020-09-11, 2022-02-1…
$ time_updat  &lt;chr&gt; "05:36:33.000", "19:21:47.000", "08:35:45.000", "11:22:31.…
$ geometry    &lt;POINT [°]&gt; POINT (35.05067 -15.72646), POINT (-1.58151 6.72312)…</code></pre>
</div>
</div>
<p>We notice that in the <code>clean_coun</code> column, there are many countries name such as Malawi, Ghana, Sierra Leone, etc. This means that the <code>wp</code> data set contains the information of other countries besides Nigeria. <code>filter()</code> of the package <strong>dplyr</strong> is used to get the data that only belongs to Nigeria.</p>
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>wp <span class="ot">&lt;-</span> wp <span class="sc">%&gt;%</span> <span class="fu">filter</span>(clean_coun <span class="sc">==</span> <span class="st">"Nigeria"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Now we will examine the filtered <code>wp</code> data set using <code>head()</code> of Base R. The function reveals that <code>wp</code> now only contains Nigeria-relevant data.</p>
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(wp, <span class="at">n =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 5 features and 72 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: 3.597668 ymin: 6.48694 xmax: 7.92972 ymax: 7.98
Geodetic CRS:  WGS 84
  row_id                                       source  lat_deg  lon_deg
1 429068                                        GRID3 7.980000 5.120000
2 222071 Federal Ministry of Water Resources, Nigeria 6.964532 3.597668
3 160612                                     WaterAid 6.486940 7.929720
4 160669                                     WaterAid 6.727570 7.648670
5 160642                                     WaterAid 6.779900 7.664850
  date_repor   time_repor status_id water_sour water_so_2      water_te_2
1 2018-08-29 00:00:00.000   Unknown       &lt;NA&gt;       &lt;NA&gt;        Tapstand
2 2015-08-16 00:00:00.000       Yes   Borehole       Well Mechanized Pump
3 2020-12-04 00:00:00.000       Yes   Borehole       Well       Hand Pump
4 2020-12-04 00:00:00.000       Yes   Borehole       Well            &lt;NA&gt;
5 2020-12-04 00:00:00.000       Yes   Borehole       Well       Hand Pump
      X_water_tec facility_t clean_coun clean_adm1    clean_adm2 clean_adm3
1        Tapstand   Improved    Nigeria      Ekiti          Moba       &lt;NA&gt;
2 Mechanized Pump   Improved    Nigeria       Ogun Obafemi-Owode       &lt;NA&gt;
3       Hand Pump   Improved    Nigeria     Ebonyi       Ohaukwu       &lt;NA&gt;
4            &lt;NA&gt;   Improved    Nigeria      Enugu       Isi-Uzo       &lt;NA&gt;
5       Hand Pump   Improved    Nigeria      Enugu       Isi-Uzo       &lt;NA&gt;
  clean_adm4 install_ye installer rehab_year rehabilita manageme_2 status_cle
1       &lt;NA&gt;         NA      &lt;NA&gt;         NA       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;
2       &lt;NA&gt;         NA      &lt;NA&gt;         NA       &lt;NA&gt;      Other Functional
3       &lt;NA&gt;         NA      &lt;NA&gt;         NA       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;
4       &lt;NA&gt;         NA      &lt;NA&gt;         NA       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;
5       &lt;NA&gt;         NA      &lt;NA&gt;         NA       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;
   pay fecal_coli fecal_co_2         subjective
1 &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;               &lt;NA&gt;
2   No       &lt;NA&gt;       &lt;NA&gt; Acceptable quality
3 &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;               &lt;NA&gt;
4 &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;               &lt;NA&gt;
5 &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;               &lt;NA&gt;
                            activity_i scheme_id      wpdx_id     notes
1 1a117ba2-5256-4801-874c-f7611a4499dd      &lt;NA&gt; 6FV7X4JC+222 Tap Water
2                                 &lt;NA&gt;      &lt;NA&gt; 6FR5XH7X+R37     Ajura
3                                 &lt;NA&gt;      &lt;NA&gt; 6FR9FWPH+QVH      &lt;NA&gt;
4                                 &lt;NA&gt;      &lt;NA&gt; 6FR9PJHX+2FF      &lt;NA&gt;
5                                 &lt;NA&gt;      &lt;NA&gt; 6FR9QMH7+XW9      &lt;NA&gt;
                                                                              orig_lnk
1 https://nigeria.africageoportal.com/datasets/GRID3::grid3-nigeria-water-points/about
2                                                                                 &lt;NA&gt;
3                                                                                 &lt;NA&gt;
4                                                                                 &lt;NA&gt;
5                                                                                 &lt;NA&gt;
  photo_lnk country_id
1      &lt;NA&gt;         NG
2      &lt;NA&gt;         NG
3      &lt;NA&gt;         NG
4      &lt;NA&gt;         NG
5      &lt;NA&gt;         NG
                                                                                          data_lnk
1                  https://catalog.waterpointdata.org/datasets/grid3-nigeria-water-points-61ae7cd9
2 https://catalog.waterpointdata.org/datasets/federal-ministry-of-water-resources-nigeria-5efb3667
3                                https://catalog.waterpointdata.org/datasets/rain-nigeria-5fe0f6d7
4                                https://catalog.waterpointdata.org/datasets/rain-nigeria-5fe0f6d7
5                                https://catalog.waterpointdata.org/datasets/rain-nigeria-5fe0f6d7
  distance_t  distance_2 distance_3 distance_4 distance_5
1   767.3742   921.79187  3146.7332   41049.94    959.365
2 13364.9005    48.87743  4167.5191   13898.65   9405.783
3  9492.7619  4333.34280   693.2112   27381.92  72060.118
4  9319.0815 23276.33227   307.7162   34823.61  31665.447
5  5437.7141 18783.56566   134.6121   40785.89  31240.904
                                                                                                                                                               water_poin
1                                                                             {"2018-08-29": {"source": "GRID3", "status_id": "Unknown", "water_tech_clean": "Tapstand"}}
2 {"2015-08-16": {"source": "Federal Ministry of Water Resources, Nigeria", "status_id": "Yes", "water_source_clean": "Borehole", "water_tech_clean": "Mechanized Pump"}}
3                                           {"2020-12-04": {"source": "WaterAid", "status_id": "Yes", "water_source_clean": "Borehole", "water_tech_clean": "Hand Pump"}}
4                                                                            {"2020-12-04": {"source": "WaterAid", "status_id": "Yes", "water_source_clean": "Borehole"}}
5                                           {"2020-12-04": {"source": "WaterAid", "status_id": "Yes", "water_source_clean": "Borehole", "water_tech_clean": "Hand Pump"}}
  rehab_prio served_pop local_popu crucialnes pressure usage_cap is_urban
1         NA         NA         NA         NA       NA       250     True
2         NA        140        887  0.1578354 0.140000      1000    False
3         NA          0          0         NA       NA       300    False
4         NA        492        492  1.0000000 1.640000       300    False
5         NA        868       1919  0.4523189 2.893333       300    False
  days_since staleness_ is_latest location_i cluster_si clean_co_2 country_na
1       1483   62.65911         T     358773          1        NGA    Nigeria
2       2592   44.17405         T     264633          1        NGA    Nigeria
3        655   81.34550         T     397972          1        NGA    Nigeria
4        655   81.34550         T     397984          1        NGA    Nigeria
5        655   81.34550         T     397982          1        NGA    Nigeria
                      water_so_3 water_tech                  status
1                            Tap       &lt;NA&gt;                    &lt;NA&gt;
2 Improved Tube well or borehole  Motorised Functional (and in use)
3  Borehole fitted with Handpump       &lt;NA&gt;                    &lt;NA&gt;
4      Gen. set powered borehole       &lt;NA&gt;                    &lt;NA&gt;
5  Borehole fitted with Handpump       &lt;NA&gt;                    &lt;NA&gt;
           adm2 adm3 management  adm1 lat_deg_or               lat_lon_de
1          &lt;NA&gt; &lt;NA&gt;       &lt;NA&gt;  &lt;NA&gt;         NA           (7.98?, 5.12?)
2 Obafemi-Owode &lt;NA&gt;      Other  Ogun         NA (6.9645317?, 3.5976683?)
3          &lt;NA&gt; &lt;NA&gt;       &lt;NA&gt; Enugu         NA     (6.48694?, 7.92972?)
4          &lt;NA&gt; &lt;NA&gt;       &lt;NA&gt; Enugu         NA     (6.72757?, 7.64867?)
5          &lt;NA&gt; &lt;NA&gt;       &lt;NA&gt; Enugu         NA      (6.7799?, 7.66485?)
  lon_deg_or
1         NA
2         NA
3         NA
4         NA
5         NA
                                                                                              public_dat
1                   https://catalog.waterpointdata.org/datafiles/grid3-nigeria-water-points-61ae7cd9.csv
2 https://catalog.waterpointdata.org/datafiles/federal-ministry-of-water-resources-nigeria-5efb3667.xlsx
3                                https://catalog.waterpointdata.org/datafiles/rain-nigeria-5fe0f6d7.xlsx
4                                https://catalog.waterpointdata.org/datafiles/rain-nigeria-5fe0f6d7.xlsx
5                                https://catalog.waterpointdata.org/datafiles/rain-nigeria-5fe0f6d7.xlsx
                                              converted count date_creat
1                                                  &lt;NA&gt;     1 2021-12-06
2 #status_id, #water_source, #pay, #status, #management     1 2020-06-30
3                                                  &lt;NA&gt;     1 2020-12-21
4                                                  &lt;NA&gt;     1 2020-12-21
5                                                  &lt;NA&gt;     1 2020-12-21
    time_creat date_updat   time_updat                  geometry
1 21:12:57.000 2021-12-06 21:12:57.000         POINT (5.12 7.98)
2 12:56:07.000 2020-06-30 12:56:07.000 POINT (3.597668 6.964532)
3 19:26:15.000 2020-12-21 19:26:15.000   POINT (7.92972 6.48694)
4 19:26:15.000 2020-12-21 19:26:15.000   POINT (7.64867 6.72757)
5 19:26:15.000 2020-12-21 19:26:15.000    POINT (7.66485 6.7799)</code></pre>
</div>
</div>
<p>Now we will write the filtered data table into a new <code>rds</code> file named <code>wp_nga</code> using the <code>write_rds()</code> function from the <strong>sf</strong> package.</p>
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(wp, <span class="st">"data/wp_nga.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>From this point on, we will work on the <code>wp_nga</code> file.</p>
</section>
<section id="exploring-the-water-point-status-data" class="level4">
<h4 class="anchored" data-anchor-id="exploring-the-water-point-status-data">Exploring the water point status data</h4>
<p>From the result of the code above, we notice that column <code>status_cle</code> has NA values. Since our goal is to examine the functionality of the water points, the data in <code>status_cle</code> should be transformed to remove the NA values. One way to do it is to recode the NA values to “Unknown”. <code>replace_na()</code> from the <strong>tidyr</strong> package is used to do the mentioned task.</p>
<p>To preserve the existing variables while adding new ones, <code>mutate()</code> from the <strong>dplyr</strong> package is used.</p>
<p>All changes are written into the <code>wp_nga</code> file using <code>read_rds()</code>.</p>
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>wp_nga <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"data/wp_nga.rds"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">status_cle =</span> <span class="fu">replace_na</span>(status_cle, <span class="st">"Unknown"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Let’s look at the distribution of <code>status_cle</code>. We will use <code>freq()</code> from the <strong>funModeling</strong> package for this task.</p>
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">freq</span>(<span class="at">data=</span>wp_nga, </span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">input =</span> <span class="st">'status_cle'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Take-home_Ex1_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>                        status_cle frequency percentage cumulative_perc
1                       Functional     45883      48.29           48.29
2                   Non-Functional     29385      30.93           79.22
3                          Unknown     10656      11.22           90.44
4      Functional but needs repair      4579       4.82           95.26
5 Non-Functional due to dry season      2403       2.53           97.79
6        Functional but not in use      1686       1.77           99.56
7         Abandoned/Decommissioned       234       0.25           99.81
8                        Abandoned       175       0.18           99.99
9 Non functional due to dry season         7       0.01          100.00</code></pre>
</div>
</div>
<p>We can see that there are two variables that carry the same meaning: <em>Non-Functional due to dry season</em> and <em>Non functional due to dry season</em>. We will use <code>replace()</code> from <strong>dplyr</strong> to do this task.</p>
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>wp_nga <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"data/wp_nga.rds"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">status_cle =</span> <span class="fu">replace</span>(status_cle, status_cle <span class="sc">==</span> <span class="st">"Non functional due to dry season"</span>, <span class="st">"Non-Functional due to dry season"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">status_cle =</span> <span class="fu">replace_na</span>(status_cle, <span class="st">"Unknown"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Let’s re-examine the distribution of <code>status_cle</code>.</p>
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">freq</span>(<span class="at">data=</span>wp_nga, </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">input =</span> <span class="st">'status_cle'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Take-home_Ex1_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>                        status_cle frequency percentage cumulative_perc
1                       Functional     45883      48.29           48.29
2                   Non-Functional     29385      30.93           79.22
3                          Unknown     10656      11.22           90.44
4      Functional but needs repair      4579       4.82           95.26
5 Non-Functional due to dry season      2410       2.54           97.80
6        Functional but not in use      1686       1.77           99.57
7         Abandoned/Decommissioned       234       0.25           99.82
8                        Abandoned       175       0.18          100.00</code></pre>
</div>
</div>
</section>
<section id="extracting-non-functional-water-point-data" class="level4">
<h4 class="anchored" data-anchor-id="extracting-non-functional-water-point-data">Extracting non-functional water point data</h4>
<p>Non-functional water points are defined as those which are not functional or abandoned. Using <code>filter()</code> from the dplyr package, we will save the non-functional water point data into a simple feature data table named <code>wpt_nonfunctional</code>.</p>
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>wpt_nonfunctional <span class="ot">&lt;-</span> wp_nga <span class="sc">%&gt;%</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(status_cle <span class="sc">%in%</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>           <span class="fu">c</span>(<span class="st">"Abandoned/Decommissioned"</span>, </span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Abandoned"</span>,</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Non-Functional"</span>,</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Non-Functional due to dry season"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Now we can inspect the distribution of non-functional water points by type using <code>freq()</code>.</p>
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">freq</span>(<span class="at">data =</span> wpt_nonfunctional, <span class="at">input =</span> <span class="st">"status_cle"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Take-home_Ex1_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>                        status_cle frequency percentage cumulative_perc
1                   Non-Functional     29385      91.25           91.25
2 Non-Functional due to dry season      2410       7.48           98.73
3         Abandoned/Decommissioned       234       0.73           99.46
4                        Abandoned       175       0.54          100.00</code></pre>
</div>
</div>
</section>
</section>
<section id="nga-aspatial-data" class="level3">
<h3 class="anchored" data-anchor-id="nga-aspatial-data"><code>nga</code> aspatial data</h3>
<section id="checking-the-crs-of-aspatial-data" class="level4">
<h4 class="anchored" data-anchor-id="checking-the-crs-of-aspatial-data">Checking the CRS of aspatial data</h4>
<p>We will check the CRS of <code>nga</code> using <code>st_geometry()</code>.</p>
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_geometry</span>(nga)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Geometry set for 774 features 
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 2.668534 ymin: 4.273007 xmax: 14.67882 ymax: 13.89442
Geodetic CRS:  WGS 84
First 5 geometries:</code></pre>
</div>
</div>
<p>As the CRS of <code>nga</code> is WGS84, we will assign <code>crs = 4326</code> using <code>st_set_crs()</code>.</p>
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>nga <span class="ot">&lt;-</span> <span class="fu">st_set_crs</span>(nga, <span class="dv">4326</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Next, we plot the geometry using <code>plot()</code> of Base R. As our data is the regions of Nigeria by administrative division management level 2, the map below depicts the <a href="https://en.wikipedia.org/wiki/Local_government_areas_of_Nigeria">774 Local Government Areas of Nigeria</a>.</p>
<p>From the map, it is noticeable that the size of government areas varies significantly. Let’s keep this in mind for further analysis 💪</p>
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(nga))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Take-home_Ex1_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="performing-point-in-polygon-count" class="level3">
<h3 class="anchored" data-anchor-id="performing-point-in-polygon-count">Performing Point-in-Polygon Count</h3>
<p>Because the geometry type of our geospatial data is <code>point</code>, we need to compute the number of points inside each polygon. The functions below will be used for that task.</p>
<ul>
<li><p><code>mutate()</code>: preserves the existing variables while adding new variables, from <strong>dplyr</strong> package</p></li>
<li><p><code>st_intersects()</code>: spatial intersect predicate for stars and sfc object, from <strong>stars</strong> package, a sub-package of <strong>tmap</strong>.</p></li>
<li><p><code>lengths()</code>: get the length of each element of a list or atomic vector as an integer or numeric vector, from Base R.</p></li>
</ul>
<p>After the aggregation, the output will in in polygon geometry shape.</p>
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>nga_wp <span class="ot">&lt;-</span> nga <span class="sc">%&gt;%</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">total wpt</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">lengths</span>(</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_intersects</span>(nga, wp_nga))) <span class="sc">%&gt;%</span> </span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">wpt non-functional</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">lengths</span>(</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_intersects</span>(nga, wpt_nonfunctional)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="saving-the-analytical-data-table" class="level3">
<h3 class="anchored" data-anchor-id="saving-the-analytical-data-table">Saving the analytical data table</h3>
<p>Before saving the data table, we will compute the percentage of non-functional water points over the total number of water points in Nigeria.</p>
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>nga_wp <span class="ot">&lt;-</span> nga_wp <span class="sc">%&gt;%</span> </span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">pct_non-functional</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">wpt non-functional</span><span class="st">`</span><span class="sc">/</span><span class="st">`</span><span class="at">total wpt</span><span class="st">`</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Now, we will save the sf data table <code>nga_wp</code> into a new rds file.</p>
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(nga_wp, <span class="st">"data/nga_wp.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="visualizing-the-data" class="level2">
<h2 class="anchored" data-anchor-id="visualizing-the-data">Visualizing the Data</h2>
<p>First, let’s reload the <code>nga_wp.rds</code> file into our working environment.</p>
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>nga_wp <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"data/nga_wp.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="displaying-non-functional-water-points-with-choropleth-map" class="level3">
<h3 class="anchored" data-anchor-id="displaying-non-functional-water-points-with-choropleth-map">Displaying non-functional water points with choropleth map</h3>
<p>To create the plots, we will use the <code>tm_shape()</code> and <code>tm_fill()</code> functions from <strong>tmap</strong> package. In addition, <code>tm_borders()</code> and <code>tm_layout()</code> will be used to customize the style of the map. Below are the functionality of the functions.</p>
<ul>
<li><p><code>tm_shape</code>: creates a tmap element that specifies the spatial data object.</p></li>
<li><p><code>tm_fill</code>: creates a tmap element that draws the polygons.</p></li>
<li><p><code>tm_borders</code>: creates a tmap element that defines the border of the polygons.</p></li>
<li><p><code>tm_layout</code>: specifies the map layout</p></li>
</ul>
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>wp_pretty <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(nga_wp) <span class="sc">+</span> </span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="st">"wpt non-functional"</span>,</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"Water Point Count"</span>) <span class="sc">+</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Pretty Classification"</span>,</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.position =</span> <span class="st">"center"</span>,</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.size =</span> <span class="dv">2</span>,</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.height =</span> <span class="fl">0.25</span>,</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.width =</span> <span class="fl">0.3</span>,</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="st">"right"</span>, <span class="st">"bottom"</span>),</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">frame =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>)</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>wp_quantile <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(nga_wp) <span class="sc">+</span> </span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="st">"wpt non-functional"</span>,</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"Water Point Count"</span>,</span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>          <span class="at">style =</span> <span class="st">"quantile"</span>) <span class="sc">+</span></span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Quantile Classification"</span>,</span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.position =</span> <span class="st">"center"</span>,</span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.size =</span> <span class="dv">2</span>,</span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.height =</span> <span class="fl">0.25</span>,</span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.width =</span> <span class="fl">0.3</span>,</span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="st">"right"</span>, <span class="st">"bottom"</span>),</span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a>            <span class="at">frame =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>)</span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a>wp_equal <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(nga_wp) <span class="sc">+</span> </span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="st">"wpt non-functional"</span>,</span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"Water Point Count"</span>,</span>
<span id="cb32-29"><a href="#cb32-29" aria-hidden="true" tabindex="-1"></a>          <span class="at">style =</span> <span class="st">"equal"</span>) <span class="sc">+</span></span>
<span id="cb32-30"><a href="#cb32-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Equal Classification"</span>,</span>
<span id="cb32-31"><a href="#cb32-31" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.position =</span> <span class="st">"center"</span>,</span>
<span id="cb32-32"><a href="#cb32-32" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.size =</span> <span class="dv">2</span>,</span>
<span id="cb32-33"><a href="#cb32-33" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.height =</span> <span class="fl">0.25</span>,</span>
<span id="cb32-34"><a href="#cb32-34" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.width =</span> <span class="fl">0.3</span>,</span>
<span id="cb32-35"><a href="#cb32-35" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="st">"right"</span>, <span class="st">"bottom"</span>),</span>
<span id="cb32-36"><a href="#cb32-36" aria-hidden="true" tabindex="-1"></a>            <span class="at">frame =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb32-37"><a href="#cb32-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>)</span>
<span id="cb32-38"><a href="#cb32-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-39"><a href="#cb32-39" aria-hidden="true" tabindex="-1"></a>wp_jenks <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(nga_wp) <span class="sc">+</span> </span>
<span id="cb32-40"><a href="#cb32-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="st">"wpt non-functional"</span>,</span>
<span id="cb32-41"><a href="#cb32-41" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"Water Point Count"</span>,</span>
<span id="cb32-42"><a href="#cb32-42" aria-hidden="true" tabindex="-1"></a>          <span class="at">style =</span> <span class="st">"jenks"</span>) <span class="sc">+</span></span>
<span id="cb32-43"><a href="#cb32-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Jenks Classification"</span>,</span>
<span id="cb32-44"><a href="#cb32-44" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.position =</span> <span class="st">"center"</span>,</span>
<span id="cb32-45"><a href="#cb32-45" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.size =</span> <span class="dv">2</span>,</span>
<span id="cb32-46"><a href="#cb32-46" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.height =</span> <span class="fl">0.25</span>,</span>
<span id="cb32-47"><a href="#cb32-47" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.width =</span> <span class="fl">0.3</span>,</span>
<span id="cb32-48"><a href="#cb32-48" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="st">"right"</span>, <span class="st">"bottom"</span>),</span>
<span id="cb32-49"><a href="#cb32-49" aria-hidden="true" tabindex="-1"></a>            <span class="at">frame =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb32-50"><a href="#cb32-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>wp_equal</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Take-home_Ex1_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>wp_pretty</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Take-home_Ex1_files/figure-html/unnamed-chunk-24-2.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>wp_jenks</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Take-home_Ex1_files/figure-html/unnamed-chunk-24-3.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>wp_quantile</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Take-home_Ex1_files/figure-html/unnamed-chunk-24-4.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>From the maps above, we can see that different interval classification produces different map views.</p>
<p><code>pretty</code> and <code>equal</code> methods divide the values into groups of equally-spaced values, so they can smooth out the distribution of non-functional water points.</p>
<p>The <code>Jenks</code> method produces well-balanced intervals. By definition, the Jenks method defines intervals so that they have the smallest in-class variance. This makes the Jenks method more suitable for high-variance data sets like <code>nga_wp</code>.</p>
<p>The <code>quantile</code> method produces a rather dire situation with a large area of land having the highest numbers of non-functional water points. However, the range of the highest quantile is relatively huge comparing to other quantiles, suggesting high variance data. We can say that the quantile method exaggerates the disfunctionality of water points in Nigeria due to outliers.</p>
<section id="displaying-data-distribution-with-histogram" class="level4">
<h4 class="anchored" data-anchor-id="displaying-data-distribution-with-histogram">Displaying data distribution with histogram</h4>
<p>To confirm the distribution of the data, we will use a histogram. From the histogram, it is clear that the data is highly skewed toward the right.</p>
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(nga_wp<span class="sc">$</span><span class="st">`</span><span class="at">wpt non-functional</span><span class="st">`</span>, <span class="at">xlab =</span> <span class="st">"Non-functional Water Point Count"</span>,</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Histogram of non-functional water points"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Take-home_Ex1_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
</section>
<section id="global-spatial-autocorrelation" class="level2">
<h2 class="anchored" data-anchor-id="global-spatial-autocorrelation">Global Spatial Autocorrelation</h2>
<p>Based on the maps above, we see that there are some areas with a higher number of non-functional water points than others. Is there a pattern for the distribution of the non-functional water points or do they just occur randomly? To answer that question, we will explore the global spatial autocorrelation of non-functional water points in Nigeria.</p>
<section id="computing-spatial-weights" class="level3">
<h3 class="anchored" data-anchor-id="computing-spatial-weights">Computing Spatial Weights</h3>
<p>Let’s consider four spatial weight methods.</p>
<ul>
<li><p><strong>Polygon Contiguity</strong>: this method defines the neighbor based on contiguity and is effective when the polygons are similar in size and distribution, and when spatial relationships are a function of polygon proximity. In this case, the size of the government areas of Nigeria have significantly varying sizes. Therefore, polygon contiguity is not a good fit.</p></li>
<li><p><strong>Fixed Distance</strong>: this method is effective for polygon data with large variation in polygon size (very large polygons at the edge of the study area, and very small polygons at the center of the study areas). On the map, we can see that Nigeria has very small government areas in the south, while bigger areas are scattered in the rest of the country, together with smaller areas in between. Therefore, the Fixed Distance method is not a good fit.</p></li>
<li><p><strong>Inverse Distance:</strong> this method is appropriate for with continuous data or to model the process where the closer the features are, the more likely they are going to interact/affect the other. The downside of this approach is that it considers every feature is potentially a neighbor of every other feature. Therefore, the method is computationally costly. Since our data set has up to 774 observations, this method is not appropriate considering the capability of our personal computer.</p></li>
<li><p><strong>Adaptive Distance (K Nearest Neighbor):</strong> this method is effective when the values associate with the features are skewed. Because our data is skewed to the right, this method is a good fit.</p></li>
</ul>
<section id="converting-data-into-projected-coordinate-system" class="level4">
<h4 class="anchored" data-anchor-id="converting-data-into-projected-coordinate-system">Converting data into projected coordinate system</h4>
<p>Because Adaptive Distance spatial weight method is distance-based spatial weight method, the data needs to be converted into projected coordinate system. The EPSG code we will convert the data into is <a href="https://epsg.io/26391">EPSG:26391</a>, used for Nigeria West Belt. We will use <code>st_transform()</code> from the <strong>sf</strong> package for the task.</p>
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>nga_wp <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(nga_wp, <span class="at">crs =</span> <span class="dv">26391</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="computing-adaptive-weight-matrix" class="level4">
<h4 class="anchored" data-anchor-id="computing-adaptive-weight-matrix">Computing Adaptive Weight Matrix</h4>
<p>As a rule of thumb, when computing adaptive weight matrix, we should ensure that each feature has at least 8 neighbors. To do the task, the functions below are called:</p>
<ul>
<li><p><a href="https://www.rdocumentation.org/packages/spdep/versions/1.2-7/topics/knn2nb"><code>knn2nb()</code></a>: converts a&nbsp;<strong>knn</strong>&nbsp;object returned by&nbsp;<strong>knearneigh</strong>&nbsp;into a neighbors list of class&nbsp;<strong>nb</strong>&nbsp;with a list of integer vectors containing neighbor region number ids.</p></li>
<li><p><a href="https://r-spatial.github.io/spdep/reference/knearneigh.html"><code>knearneigh()</code></a>: returns a matrix with the indices of points belonging to the set of the k nearest neighbours of each other.</p></li>
<li><p><a href="https://purrr.tidyverse.org/reference/map.html"><code>map_dbl()</code></a>: returns an atomic vector of the indicative type.</p></li>
<li><p><a href="https://r-spatial.github.io/sf/reference/geos_unary.html"><code>st_centroid()</code></a>: calculates and retrieve the centroid of the feature.</p></li>
<li><p><a href="https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/cbind"><code>cbind()</code></a>: merges two data frames/vectors/matrices together</p></li>
</ul>
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Calculate the longitude and latitude</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>longitude <span class="ot">&lt;-</span> <span class="fu">map_dbl</span>(nga_wp<span class="sc">$</span>geometry, <span class="sc">~</span><span class="fu">st_centroid</span>(.x)[[<span class="dv">1</span>]])</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>latitude <span class="ot">&lt;-</span> <span class="fu">map_dbl</span>(nga_wp<span class="sc">$</span>geometry, <span class="sc">~</span><span class="fu">st_centroid</span>(.x)[[<span class="dv">2</span>]])</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>coords <span class="ot">&lt;-</span> <span class="fu">cbind</span>(longitude, latitude)</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>wp_k8 <span class="ot">&lt;-</span> <span class="fu">knn2nb</span>(<span class="fu">knearneigh</span>(coords, <span class="at">k =</span> <span class="dv">8</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Displaying the content of <code>wp_k8</code> matrix using <code>str()</code>. Each feature has 8 neighbors.</p>
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(wp_k8)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>List of 774
 $ : int [1:8] 2 321 364 548 597 624 721 725
 $ : int [1:8] 1 321 548 597 624 721 725 726
 $ : int [1:8] 241 250 261 447 492 507 509 526
 $ : int [1:8] 12 20 257 263 446 454 466 690
 $ : int [1:8] 203 208 286 288 331 334 539 738
 $ : int [1:8] 170 217 218 337 379 553 577 601
 $ : int [1:8] 8 176 214 281 283 306 544 555
 $ : int [1:8] 7 214 281 306 327 544 555 651
 $ : int [1:8] 18 19 218 337 574 576 601 757
 $ : int [1:8] 25 216 325 364 365 528 552 632
 $ : int [1:8] 26 27 43 68 191 524 565 762
 $ : int [1:8] 135 263 417 429 446 454 690 695
 $ : int [1:8] 31 37 211 320 393 570 583 584
 $ : int [1:8] 170 363 379 546 563 577 581 589
 $ : int [1:8] 22 49 82 177 297 306 580 623
 $ : int [1:8] 30 187 188 296 328 357 360 635
 $ : int [1:8] 35 275 295 378 460 591 638 639
 $ : int [1:8] 9 19 218 376 574 576 601 757
 $ : int [1:8] 9 18 56 103 376 574 576 601
 $ : int [1:8] 4 106 125 239 263 419 454 466
 $ : int [1:8] 60 61 162 269 520 578 596 626
 $ : int [1:8] 49 297 326 443 515 623 682 693
 $ : int [1:8] 54 291 292 536 537 614 618 619
 $ : int [1:8] 84 123 437 476 527 652 673 761
 $ : int [1:8] 10 181 216 314 325 366 552 730
 $ : int [1:8] 11 27 68 191 336 439 562 762
 $ : int [1:8] 11 26 191 439 562 565 663 762
 $ : int [1:8] 29 178 299 300 301 358 369 598
 $ : int [1:8] 172 173 178 182 358 378 460 591
 $ : int [1:8] 16 39 41 186 192 329 357 360
 $ : int [1:8] 13 37 211 289 561 570 583 584
 $ : int [1:8] 51 62 461 462 515 623 682 693
 $ : int [1:8] 47 166 227 238 242 655 743 750
 $ : int [1:8] 42 104 136 137 213 553 559 757
 $ : int [1:8] 17 275 276 277 278 279 295 460
 $ : int [1:8] 50 107 247 408 432 455 681 759
 $ : int [1:8] 38 40 211 212 570 583 584 629
 $ : int [1:8] 30 39 40 41 186 192 320 570
 $ : int [1:8] 30 38 40 41 186 192 320 329
 $ : int [1:8] 37 38 39 41 186 192 320 570
 $ : int [1:8] 30 38 39 40 186 192 360 634
 $ : int [1:8] 86 136 137 499 587 613 718 734
 $ : int [1:8] 11 68 157 524 549 565 590 645
 $ : int [1:8] 16 45 192 290 303 328 360 634
 $ : int [1:8] 44 187 290 303 328 341 360 599
 $ : int [1:8] 387 417 429 438 459 521 668 742
 $ : int [1:8] 33 111 166 234 238 691 698 750
 $ : int [1:8] 65 113 265 386 407 428 482 701
 $ : int [1:8] 22 32 297 326 515 623 682 693
 $ : int [1:8] 36 98 107 247 409 416 432 681
 $ : int [1:8] 32 62 461 462 515 580 623 693
 $ : int [1:8] 53 78 165 293 532 602 603 636
 $ : int [1:8] 52 78 80 165 280 602 621 636
 $ : int [1:8] 23 79 293 294 532 536 537 618
 $ : int [1:8] 122 169 246 333 430 571 605 697
 $ : int [1:8] 77 368 376 533 534 576 601 728
 $ : int [1:8] 53 58 199 312 322 323 621 622
 $ : int [1:8] 57 322 323 564 602 603 621 622
 $ : int [1:8] 88 128 129 259 493 700 714 748
 $ : int [1:8] 61 158 563 578 589 592 596 626
 $ : int [1:8] 21 60 269 578 589 592 596 626
 $ : int [1:8] 32 51 461 462 515 623 682 693
 $ : int [1:8] 90 237 384 416 467 497 765 772
 $ : int [1:8] 48 65 74 113 131 265 386 407
 $ : int [1:8] 48 64 74 113 265 407 683 701
 $ : int [1:8] 19 103 104 288 331 338 351 574
 $ : int [1:8] 347 348 560 566 567 609 640 694
 $ : int [1:8] 11 43 157 190 191 549 590 645
 $ : int [1:8] 140 146 248 274 473 500 512 513
 $ : int [1:8] 71 298 299 301 341 343 344 610
 $ : int [1:8] 70 172 173 298 299 343 344 625
 $ : int [1:8] 17 361 566 567 568 609 638 639
 $ : int [1:8] 72 361 374 377 404 607 665 666
 $ : int [1:8] 65 109 113 251 265 683 741 754
 $ : int [1:8] 110 272 398 422 433 485 501 768
 $ : int [1:8] 254 287 427 459 470 547 647 677
 $ : int [1:8] 56 195 533 534 579 618 619 728
 $ : int [1:8] 52 54 79 80 165 215 532 636
 $ : int [1:8] 54 78 165 293 532 579 618 636
 $ : int [1:8] 52 53 78 165 215 280 636 739
 $ : int [1:8] 99 145 227 233 426 483 689 760
 $ : int [1:8] 15 32 49 51 177 352 580 623
 $ : int [1:8] 132 258 383 414 433 529 767 768
 $ : int [1:8] 24 131 148 386 437 482 673 692
 $ : int [1:8] 105 156 267 394 654 675 707 712
 $ : int [1:8] 42 136 137 499 587 613 718 734
 $ : int [1:8] 149 151 221 226 399 410 486 657
 $ : int [1:8] 59 116 128 150 489 648 700 714
 $ : int [1:8] 260 408 463 542 674 676 681 759
 $ : int [1:8] 63 163 236 237 384 452 710 765
 $ : int [1:8] 160 271 388 406 473 475 492 525
 $ : int [1:8] 95 119 390 391 392 423 487 656
 $ : int [1:8] 73 354 374 402 594 607 665 666
 $ : int [1:8] 13 31 60 158 436 561 596 709
 $ : int [1:8] 92 390 391 392 405 423 469 656
 $ : int [1:8] 97 139 389 403 420 451 488 653
 $ : int [1:8] 96 168 389 420 451 653 662 773
 $ : int [1:8] 50 117 153 231 409 432 696 708
 $ : int [1:8] 81 145 426 483 667 689 760 769
  [list output truncated]
 - attr(*, "region.id")= chr [1:774] "1" "2" "3" "4" ...
 - attr(*, "call")= language knearneigh(x = coords, k = 8)
 - attr(*, "sym")= logi FALSE
 - attr(*, "type")= chr "knn"
 - attr(*, "knn-k")= num 8
 - attr(*, "class")= chr "nb"</code></pre>
</div>
</div>
<p>Now we can plot the adaptive spatial weight matrix.</p>
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(nga_wp<span class="sc">$</span>geometry, <span class="at">border =</span> <span class="st">"lightgrey"</span>, <span class="at">main =</span> <span class="st">"K Nearest Neighbor Matrix"</span>)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(wp_k8, coords, <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">cex =</span> <span class="fl">0.2</span>, <span class="at">add =</span> <span class="cn">TRUE</span>, <span class="at">col =</span> <span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Take-home_Ex1_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="row-standardized-weight-matrix" class="level4">
<h4 class="anchored" data-anchor-id="row-standardized-weight-matrix">Row standardized weight matrix</h4>
<p>We will compute a row standardized weight matrix based on <code>wp_k8</code> by using <code>nb2listw()</code> from <strong>spdep</strong> package. Since the data has 774 observations, which is a high number, <code>style = "B"</code> is used for a more robust analysis.</p>
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>wp_rsw <span class="ot">&lt;-</span> <span class="fu">nb2listw</span>(wp_k8, <span class="at">style =</span> <span class="st">"B"</span>, <span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>wp_rsw</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Characteristics of weights list object:
Neighbour list object:
Number of regions: 774 
Number of nonzero links: 6192 
Percentage nonzero weights: 1.033592 
Average number of links: 8 
Non-symmetric neighbours list

Weights style: B 
Weights constants summary:
    n     nn   S0    S1     S2
B 774 599076 6192 11154 201940</code></pre>
</div>
</div>
</section>
</section>
<section id="global-spatial-autocorrelation-morans-i" class="level3">
<h3 class="anchored" data-anchor-id="global-spatial-autocorrelation-morans-i">Global Spatial Autocorrelation: Moran’s I</h3>
<section id="morans-i-test" class="level4">
<h4 class="anchored" data-anchor-id="morans-i-test">Moran’s I test</h4>
<p>To perform the Moran’s I test, we will use <code>moran.test()</code> from <strong>spdep</strong> package.</p>
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">moran.test</span>(nga_wp<span class="sc">$</span><span class="st">`</span><span class="at">wpt non-functional</span><span class="st">`</span>, <span class="at">listw =</span> wp_rsw, <span class="at">zero.policy =</span> <span class="cn">TRUE</span>, <span class="at">na.action =</span> na.omit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Moran I test under randomisation

data:  nga_wp$`wpt non-functional`  
weights: wp_rsw    

Moran I statistic standard deviate = 22.72, p-value &lt; 2.2e-16
alternative hypothesis: greater
sample estimates:
Moran I statistic       Expectation          Variance 
     0.3830962455     -0.0012936611      0.0002862476 </code></pre>
</div>
</div>
<p>Because the p-value of the test is less than 0.05, we reject the null hypothesis that the non-functional water points are spatially random at 95% confident interval. As the Moran statistic is 0.383, greater than 0, we can say that the non-functional water point observations are clustered.</p>
</section>
<section id="monte-carlo-morans-i" class="level4">
<h4 class="anchored" data-anchor-id="monte-carlo-morans-i">Monte Carlo Moran’s I</h4>
<p>To compute 1,000 simulations of Monte Carlo Moran’s I, we will use <code>moran.mc()</code> from <strong>spdep</strong> package.</p>
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>mc_moran <span class="ot">=</span> <span class="fu">moran.mc</span>(nga_wp<span class="sc">$</span><span class="st">`</span><span class="at">wpt non-functional</span><span class="st">`</span>,</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">listw =</span> wp_rsw,</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">nsim =</span> <span class="dv">999</span>,</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">zero.policy =</span> <span class="cn">TRUE</span>,</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>                    <span class="at">na.action =</span> na.omit)</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>mc_moran</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Monte-Carlo simulation of Moran I

data:  nga_wp$`wpt non-functional` 
weights: wp_rsw  
number of simulations + 1: 1000 

statistic = 0.3831, observed rank = 1000, p-value = 0.001
alternative hypothesis: greater</code></pre>
</div>
</div>
<p>As p-value is 0.001 and less than 0.05, we reject the null hypothesis of spatial randomness among the non-functional water point observations. The statistic of the Moran’s I simulations is 0.3831, greater than 0, corroborating the test result that similar non-functional water point observations are clustered.</p>
</section>
<section id="visualzing-monte-carlo-morans-i" class="level4">
<h4 class="anchored" data-anchor-id="visualzing-monte-carlo-morans-i">Visualzing Monte Carlo Moran’s I</h4>
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mc_moran<span class="sc">$</span>res)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>      Min.    1st Qu.     Median       Mean    3rd Qu.       Max. 
-0.0577464 -0.0127344 -0.0011002 -0.0002353  0.0109820  0.3830962 </code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(mc_moran<span class="sc">$</span>res,</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">freq =</span> <span class="cn">TRUE</span>,</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">breaks =</span> <span class="dv">20</span>,</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Simulated Moran's I"</span>,</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Histogram of Moran's I Simulation"</span>)</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="dv">0</span>, <span class="at">col =</span> <span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Take-home_Ex1_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We can see that the min of the Moran’s I value is less than 0, while the max value is 0.38. The Moran’s I data is approaching 1, inferring similar values are clustered. In layman terms, government areas with similar number of non-functional water points tend to be closer together and form some clusters.</p>
</section>
</section>
<section id="global-spatial-autocorrelation-gearys-c" class="level3">
<h3 class="anchored" data-anchor-id="global-spatial-autocorrelation-gearys-c">Global Spatial Autocorrelation: Geary’s C</h3>
<p>The following section will focus on Geary’s C test and Geary’s C Monte Carlo simulation using the functions from <strong>spdep</strong> package.</p>
<section id="gearys-c-test" class="level4">
<h4 class="anchored" data-anchor-id="gearys-c-test">Geary’s C Test</h4>
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">geary.test</span>(nga_wp<span class="sc">$</span><span class="st">`</span><span class="at">wpt non-functional</span><span class="st">`</span>, <span class="at">listw =</span> wp_rsw)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Geary C test under randomisation

data:  nga_wp$`wpt non-functional` 
weights: wp_rsw 

Geary C statistic standard deviate = 19.419, p-value &lt; 2.2e-16
alternative hypothesis: Expectation greater than statistic
sample estimates:
Geary C statistic       Expectation          Variance 
     0.6045301723      1.0000000000      0.0004147472 </code></pre>
</div>
</div>
<p>Because p-value is 0.001 and less than 0.05, we reject the null hypothesis of spatial randomness among the non-functional water point observations with 95% confident interval. The statistic of the Geary’s C simulations is 0.605, less than 1, we can say that the data tend to cluster among similar observations.</p>
</section>
<section id="monte-carlo-gearys-c" class="level4">
<h4 class="anchored" data-anchor-id="monte-carlo-gearys-c">Monte Carlo Geary’s C</h4>
<p>We will compute 1000 simulations of Geary’s C using <code>geary.mc()</code>.</p>
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>mc_geary <span class="ot">=</span> <span class="fu">geary.mc</span>(nga_wp<span class="sc">$</span><span class="st">`</span><span class="at">wpt non-functional</span><span class="st">`</span>, <span class="at">listw =</span> wp_rsw, <span class="at">nsim =</span> <span class="dv">999</span>)</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>mc_geary</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Monte-Carlo simulation of Geary C

data:  nga_wp$`wpt non-functional` 
weights: wp_rsw 
number of simulations + 1: 1000 

statistic = 0.60453, observed rank = 1, p-value = 0.001
alternative hypothesis: greater</code></pre>
</div>
</div>
<p>The result of the simulation corroborates the previous Geary’s C test with p-value less than 0.05 and Geary’s C statistic less than 1.</p>
</section>
<section id="visualizing-monte-carlo-gearys-c" class="level4">
<h4 class="anchored" data-anchor-id="visualizing-monte-carlo-gearys-c">Visualizing Monte Carlo Geary’s C</h4>
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mc_geary<span class="sc">$</span>res)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.6045  0.9857  0.9995  0.9987  1.0128  1.0690 </code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(mc_geary<span class="sc">$</span>res,</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">freq =</span> <span class="cn">TRUE</span>,</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">breaks =</span> <span class="dv">20</span>,</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Histogram of Geary's C Simulation"</span>,</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Simulated Geary's C"</span>)</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="dv">1</span>, <span class="at">col =</span> <span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Take-home_Ex1_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We can see that the min Geary’s C is less than 1, while the max is greater than 1. The Geary’s C data is approaching 0, meaning similar values are clustered. This result again is similar to Moran’s I. We have areas with similar number of non-functional water points clustering together.</p>
</section>
</section>
</section>
<section id="spatial-correlogram-with-morans-i" class="level2">
<h2 class="anchored" data-anchor-id="spatial-correlogram-with-morans-i">Spatial Correlogram with Moran’s I</h2>
<p>We will use <code>sp.correlogram()</code> from spdep package to compute a 6-lag spatial correlogram of non-functional water points.</p>
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>MI_corr <span class="ot">&lt;-</span> <span class="fu">sp.correlogram</span>(wp_k8, </span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>                          nga_wp<span class="sc">$</span><span class="st">`</span><span class="at">wpt non-functional</span><span class="st">`</span>, </span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">order=</span><span class="dv">10</span>, </span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">method=</span><span class="st">"I"</span>, </span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>                          <span class="at">style=</span><span class="st">"W"</span>)</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(MI_corr, <span class="at">main =</span> <span class="st">"Moran's I Correlogram of Non-functional Water Points"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Take-home_Ex1_files/figure-html/unnamed-chunk-39-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(MI_corr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Spatial correlogram for nga_wp$`wpt non-functional` 
method: Moran's I
            estimate expectation    variance standard deviate Pr(I) two sided
1 (774)   3.8310e-01 -1.2937e-03  2.8625e-04          22.7196       &lt; 2.2e-16
2 (774)   2.4978e-01 -1.2937e-03  1.4428e-04          20.9027       &lt; 2.2e-16
3 (774)   1.7519e-01 -1.2937e-03  9.8557e-05          17.7769       &lt; 2.2e-16
4 (774)   1.1512e-01 -1.2937e-03  7.3007e-05          13.6241       &lt; 2.2e-16
5 (774)   7.3384e-02 -1.2937e-03  5.7171e-05           9.8765       &lt; 2.2e-16
6 (774)   3.3259e-02 -1.2937e-03  4.7493e-05           5.0137       5.338e-07
7 (774)   2.3599e-03 -1.2937e-03  4.1538e-05           0.5669       0.5708000
8 (774)  -2.3438e-02 -1.2937e-03  3.7172e-05          -3.6322       0.0002811
9 (774)  -5.8066e-02 -1.2937e-03  3.4217e-05          -9.7054       &lt; 2.2e-16
10 (774) -9.0732e-02 -1.2937e-03  3.2640e-05         -15.6549       &lt; 2.2e-16
            
1 (774)  ***
2 (774)  ***
3 (774)  ***
4 (774)  ***
5 (774)  ***
6 (774)  ***
7 (774)     
8 (774)  ***
9 (774)  ***
10 (774) ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>The higher the lag value, the lower the estimation of Moran’s I value. From lag 8, the values start to be dispersed with Moran’s I estimation less than 0. Except for lag 7, we can reject the null hypothesis of spatial randomness for other lag values.</p>
</section>
<section id="cluster-and-outlier-analysis" class="level2">
<h2 class="anchored" data-anchor-id="cluster-and-outlier-analysis">Cluster and Outlier Analysis</h2>
<p>In this segment, we will examine the existence of clusters in the spatial arrangement of non-functional water points. The statistical method we will use is Local Indicators of Spatial Association, or LISA for short.</p>
<section id="computing-local-morans-i" class="level3">
<h3 class="anchored" data-anchor-id="computing-local-morans-i">Computing local Moran’s I</h3>
<p>To compute local Moran's I, the <a href="https://r-spatial.github.io/spdep/reference/localmoran.html"><em>localmoran()</em></a> function of <strong>spdep</strong> will be used. We will display the local Moran matrix using <code>printCoefmat()</code>.</p>
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>fips <span class="ot">&lt;-</span> <span class="fu">order</span>(nga_wp<span class="sc">$</span>shapeName)</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>localMI <span class="ot">&lt;-</span> <span class="fu">localmoran</span>(nga_wp<span class="sc">$</span><span class="st">`</span><span class="at">wpt non-functional</span><span class="st">`</span>, wp_rsw)</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(localMI)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>           Ii          E.Ii       Var.Ii       Z.Ii Pr(z != E(Ii))
1 -0.64557011 -7.996194e-03 6.1268059630 -0.2575808    0.796730455
2 -0.18338854 -3.273970e-04 0.2510973197 -0.3653214    0.714871500
3 10.06559878 -1.302147e-02 9.9709777352  3.1917746    0.001414017
4 -0.25538147 -4.342004e-04 0.3330057298 -0.4417988    0.658634818
5  0.73333147 -2.072772e-03 1.5893664318  0.5833297    0.559671349
6  0.06300119 -1.230756e-06 0.0009439673  2.0505897    0.040306916</code></pre>
</div>
</div>
</section>
<section id="mapping-the-local-morans-i" class="level3">
<h3 class="anchored" data-anchor-id="mapping-the-local-morans-i">Mapping the local Moran’s I</h3>
<p>Before mapping the local Moran’s I, we will append the local Moran’s dataframe <code>localMI</code> into <code>nga_wp</code> using <code>cbind()</code>.</p>
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>nga_wp.LMI <span class="ot">&lt;-</span> <span class="fu">cbind</span>(nga_wp, localMI) <span class="sc">%&gt;%</span> </span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Pr.Ii =</span> Pr.z....E.Ii..)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Now we can map the local Moran’s I statistics and their p-values.</p>
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>localMI.map <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(nga_wp.LMI) <span class="sc">+</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">"Ii"</span>,</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">style =</span> <span class="st">"pretty"</span>,</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"Local Moran Stats"</span>) <span class="sc">+</span></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">legend.height =</span> <span class="fl">0.25</span>,</span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.width =</span> <span class="fl">0.3</span>)</span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>pvalueMI <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(nga_wp.LMI) <span class="sc">+</span></span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">"Pr.Ii"</span>,</span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a>          <span class="at">breaks =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="cn">Inf</span>, <span class="fl">0.001</span>, <span class="fl">0.01</span>, <span class="fl">0.05</span>, <span class="fl">0.1</span>, <span class="cn">Inf</span>),</span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a>          <span class="at">palette =</span> <span class="st">"-Blues"</span>,</span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"Local Moran p-value"</span>) <span class="sc">+</span></span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">legend.height =</span> <span class="fl">0.25</span>,</span>
<span id="cb65-16"><a href="#cb65-16" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.width =</span> <span class="fl">0.3</span>)</span>
<span id="cb65-17"><a href="#cb65-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-18"><a href="#cb65-18" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_arrange</span>(localMI.map, pvalueMI, <span class="at">asp =</span> <span class="dv">1</span>, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Take-home_Ex1_files/figure-html/unnamed-chunk-43-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Where p-values are less than 0.05, we can reject the null hypothesis of local spatial randomness. The areas with darker color on the p-value map is where the observations of non-functional water points are not distributed randomly.</p>
</section>
</section>
<section id="lisa-cluster-map" class="level2">
<h2 class="anchored" data-anchor-id="lisa-cluster-map">LISA Cluster Map</h2>
<section id="plotting-moran-scatterplots" class="level3">
<h3 class="anchored" data-anchor-id="plotting-moran-scatterplots">Plotting Moran scatterplots</h3>
<p>With Moran scatterplot, we can see the relationship between the value of the chosen attribute at each location and the average value of the same attribute at neighboring locations. The Moran scatterplot is drawn using <code>moran.plot()</code> from <strong>spdep</strong> package.</p>
<p>Two scatterplots will be drawn. One with non-standardized variable and the other one with standardized variable.</p>
<p>First, we will use scale to standardize the variables.</p>
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>nga_wp<span class="sc">$</span>Z.wptnon <span class="ot">&lt;-</span> <span class="fu">scale</span>(nga_wp<span class="sc">$</span><span class="st">`</span><span class="at">wpt non-functional</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>  as.vector</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The two scatterplots are drafted as below.</p>
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>nci <span class="ot">&lt;-</span> <span class="fu">moran.plot</span>(nga_wp<span class="sc">$</span><span class="st">`</span><span class="at">wpt non-functional</span><span class="st">`</span>, wp_rsw,</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">labels =</span> <span class="cn">FALSE</span>, </span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">xlab =</span> <span class="st">"Non-functional Water Points"</span>, </span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylab =</span> <span class="st">"Spatially Lag Non-functional Water Points"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Take-home_Ex1_files/figure-html/unnamed-chunk-45-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>nci2 <span class="ot">&lt;-</span> <span class="fu">moran.plot</span>(nga_wp<span class="sc">$</span>Z.wptnon, wp_rsw,</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">labels =</span> <span class="cn">FALSE</span>,</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">xlab =</span> <span class="st">"z-Nonfunctional Water Points"</span>,</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">ylab =</span> <span class="st">"Spatially Lag z-Nonfunctional Water Points"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Take-home_Ex1_files/figure-html/unnamed-chunk-45-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We can see that there are many observations in the high-high and low-high regions. We also have some observations in the high-low region. Let’s use the choropleth map to see more!</p>
</section>
<section id="plotting-lisa-map" class="level3">
<h3 class="anchored" data-anchor-id="plotting-lisa-map">Plotting LISA map</h3>
<p>Before drawing the map, we need to prepare the data so that the observations are grouped into the four classes (quadrants) as displayed in the scatterplots.</p>
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>quadrant <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">"numeric"</span>, <span class="at">length =</span> <span class="fu">nrow</span>(localMI))</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>nga_wp<span class="sc">$</span>lag_wptnon <span class="ot">&lt;-</span> <span class="fu">lag.listw</span>(wp_rsw, nga_wp<span class="sc">$</span><span class="st">`</span><span class="at">wpt non-functional</span><span class="st">`</span>)</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>DV <span class="ot">&lt;-</span> nga_wp<span class="sc">$</span>lag_wptnon <span class="sc">-</span> <span class="fu">mean</span>(nga_wp<span class="sc">$</span>lag_wptnon)</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>LM_I <span class="ot">&lt;-</span> localMI[,<span class="dv">1</span>] <span class="sc">-</span> <span class="fu">mean</span>(localMI[,<span class="dv">1</span>])</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>signif <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>quadrant[DV <span class="sc">&lt;</span><span class="dv">0</span> <span class="sc">&amp;</span> LM_I<span class="sc">&gt;</span><span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>quadrant[DV <span class="sc">&gt;</span><span class="dv">0</span> <span class="sc">&amp;</span> LM_I<span class="sc">&lt;</span><span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>quadrant[DV <span class="sc">&lt;</span><span class="dv">0</span> <span class="sc">&amp;</span> LM_I<span class="sc">&lt;</span><span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">3</span>  </span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a>quadrant[DV <span class="sc">&gt;</span><span class="dv">0</span> <span class="sc">&amp;</span> LM_I<span class="sc">&gt;</span><span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a>quadrant[localMI[,<span class="dv">5</span>]<span class="sc">&gt;</span>signif] <span class="ot">&lt;-</span> <span class="dv">0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Below is the LISA map in comparison with the aggregate map of non-functional water point count. For the aggregate map, we will display <code>wp_jenks</code>, which is based on Jenks classification.</p>
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>nga_wp.LMI<span class="sc">$</span>quadrant <span class="ot">&lt;-</span> quadrant</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#ffffff"</span>, <span class="st">"#2c7bb6"</span>, <span class="st">"#abd9e9"</span>, <span class="st">"#fdae61"</span>, <span class="st">"#d7191c"</span>)</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>clusters <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"insignificant"</span>, <span class="st">"low-low"</span>, <span class="st">"low-high"</span>, <span class="st">"high-low"</span>, <span class="st">"high-high"</span>)</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>LISAmap <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(nga_wp.LMI) <span class="sc">+</span></span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">"quadrant"</span>, </span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>          <span class="at">style =</span> <span class="st">"cat"</span>, </span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>          <span class="at">palette =</span> colors[<span class="fu">c</span>(<span class="fu">sort</span>(<span class="fu">unique</span>(quadrant)))<span class="sc">+</span><span class="dv">1</span>], </span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a>          <span class="at">labels =</span> clusters[<span class="fu">c</span>(<span class="fu">sort</span>(<span class="fu">unique</span>(quadrant)))<span class="sc">+</span><span class="dv">1</span>],</span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a>          <span class="at">popup.vars =</span> <span class="fu">c</span>(<span class="st">""</span>)) <span class="sc">+</span></span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_view</span>(<span class="at">set.zoom.limits =</span> <span class="fu">c</span>(<span class="dv">11</span>,<span class="dv">17</span>)) <span class="sc">+</span></span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha=</span><span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"LISA Map"</span>,</span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.size =</span> <span class="dv">1</span>,</span>
<span id="cb70-15"><a href="#cb70-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.position =</span> <span class="st">"center"</span>,</span>
<span id="cb70-16"><a href="#cb70-16" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.height =</span> <span class="fl">0.25</span>,</span>
<span id="cb70-17"><a href="#cb70-17" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.width =</span> <span class="fl">0.3</span>)</span>
<span id="cb70-18"><a href="#cb70-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-19"><a href="#cb70-19" aria-hidden="true" tabindex="-1"></a>wp_jenks1 <span class="ot">&lt;-</span> wp_jenks <span class="sc">+</span> <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Aggregated Map (Jenks)"</span>,</span>
<span id="cb70-20"><a href="#cb70-20" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">main.title.size =</span> <span class="dv">1</span>,</span>
<span id="cb70-21"><a href="#cb70-21" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">frame =</span> <span class="cn">TRUE</span>)</span>
<span id="cb70-22"><a href="#cb70-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-23"><a href="#cb70-23" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_arrange</span>(wp_jenks1, LISAmap, </span>
<span id="cb70-24"><a href="#cb70-24" aria-hidden="true" tabindex="-1"></a>             <span class="at">asp=</span><span class="dv">1</span>, <span class="at">ncol=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Take-home_Ex1_files/figure-html/unnamed-chunk-47-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The LISA map highlight the areas where spatial autocorrelation is statistically significant. The red polygons depict clusters of government areas that have a high number of non-functional water points. They are surrounded by clusters of low number of non-functional water points. The blue polygons are clusters of areas with low number of non-functional water points. Except for the east regions, those areas are surrounded by clusters of areas with more non-functional water points, which are shown in orange.</p>
<p>By comparing the LISA map with the aggregated map, we can see that the LISA map highlights the pattern of non-functional water points distribution better, especially when we want to compare how area clusters are different from their neighbors.</p>
<p>Interestingly enough, the low-low areas in the north east overlap with the states that have lower population density. The small orange dot in the east is Maiduguri, the largest city in north-eastern Nigeria. In contrast, Lagos, the largest city of Nigeria lying on the south western coast, belongs to the low-low category. This Lagos pattern repeats in the northern city of Kano, Nigeria’s second largest city.</p>
</section>
</section>
<section id="hot-spot-and-cold-spot-analysis" class="level2">
<h2 class="anchored" data-anchor-id="hot-spot-and-cold-spot-analysis">Hot Spot and Cold Spot Analysis</h2>
<p>An alternative to detect spatial anomalies besides Moran’s I LISA is Getis and Ord’s G-statistics. This method is distance-based as it looks into areas within a predefined proximity and identifies if high/low values cluster spatially. Statistically areas of high values are considered hot spots, while areas with low values are considered cold spots.</p>
<section id="computing-gi-statistics" class="level3">
<h3 class="anchored" data-anchor-id="computing-gi-statistics">Computing Gi statistics</h3>
<p>Before we can map the hot-and-cold-spot map, let’s calculate the Gi statistics using the adaptive distance weight method. The functions used are <a href="https://www.rdocumentation.org/packages/spdep/versions/1.1-3/topics/localG"><code>localG()</code></a> from <strong>spdep</strong>. <code>localG()</code> calculates the spatial statistic G, returning a Z-value vector. The higher the Z-value, the higher the clustering intensity. Positive and negative Z-score means high an low clusters, respectively.</p>
<p>After the Z-value vector is calculated, we convert it into an r matrix, then use <code>cbind()</code> to append it to <code>nga_wp</code>. We also rename <code>as.matrix.gi.adaptive.</code> to <code>gstat_adaptive</code> for easier reference.</p>
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>fips <span class="ot">&lt;-</span> <span class="fu">order</span>(nga_wp<span class="sc">$</span>shapeName)</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>gi.adaptive <span class="ot">&lt;-</span> <span class="fu">localG</span>(nga_wp<span class="sc">$</span><span class="st">`</span><span class="at">wpt non-functional</span><span class="st">`</span>, wp_rsw)</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>wp_gi <span class="ot">&lt;-</span> <span class="fu">cbind</span>(nga_wp, <span class="fu">as.matrix</span>(gi.adaptive)) <span class="sc">%&gt;%</span> </span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">gstat_adaptive =</span> as.matrix.gi.adaptive.)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="mapping-gi-values" class="level3">
<h3 class="anchored" data-anchor-id="mapping-gi-values">Mapping Gi values</h3>
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>Gimap <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(wp_gi) <span class="sc">+</span> </span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">"gstat_adaptive"</span>, </span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">style =</span> <span class="st">"pretty"</span>, </span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">palette=</span><span class="st">"-RdBu"</span>, </span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"local Gi"</span>) <span class="sc">+</span> </span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Gi Map"</span>,</span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.size =</span> <span class="dv">1</span>,</span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.position =</span> <span class="st">"center"</span>,</span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.height =</span> <span class="fl">0.25</span>,</span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.width =</span> <span class="fl">0.3</span>)</span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_arrange</span>(wp_jenks1, Gimap, <span class="at">asp =</span> <span class="dv">1</span>, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Take-home_Ex1_files/figure-html/unnamed-chunk-49-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>With GI map, we can see the intensity of the cluster values. The Gi map have some hot spots that overlap with the areas containing high number of non-functional water points on the aggregate map. What is interesting is that Gi map shows the “temperature” of those areas in relations with their neighbors.</p>
</section>
</section>
<section id="comparing-lisa-and-gi-maps" class="level2">
<h2 class="anchored" data-anchor-id="comparing-lisa-and-gi-maps">Comparing LISA and Gi Maps</h2>
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_arrange</span>(LISAmap, Gimap, <span class="at">asp =</span> <span class="dv">1</span>, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Take-home_Ex1_files/figure-html/unnamed-chunk-50-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>There are some difference in how each method define clusters of similarly high number of non-functional water points by area. However, there are also overlaps between the two maps. LISA map is more effective when we want to display the contrast between the clusters and how they allocate, while Gi map can be used to depict the intensity of the cluster and values.</p>
</section>
<section id="conclusion-and-improvement" class="level2">
<h2 class="anchored" data-anchor-id="conclusion-and-improvement">Conclusion and Improvement</h2>
<p>Based on the LISA and Gi map, there is a consistent pattern of areas with high values of non-functional water points. Those areas with high number of water point malfunctions often cluster together, suggesting the effect of unknown factors affecting the quality of water points.</p>
<p>The blue areas regions lead to two hypothesis:</p>
<ul>
<li><p>The blue areas in the south overlap with the Niger Delta. Do the presence of rivers and subsequent infrastructures affect the quality and maintenance of water points?</p></li>
<li><p>The blue areas in the north east overlap with the states that have low population density. Could it be that low population density leading to less water points installation or less usage, which leading to them malfunction less?</p></li>
</ul>
<p>More data can be collected to determine the correlation of other variable with non-functional water points. There are many potential to continue on identifying the factors that affect water point functionality. Who knows, maybe we will find some solutions to improve Nigerians’ access to fresh water 💧</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>
